{% extends "staff_page.html" %}

{% block content %}
<div class="departments-container">
    {% for dep in context %}
        <div class="department-card">
            <div class="department-header">
                <h2 class="department-title">
                    <span class="department-icon">üè¢</span>
                    {{ dep.departament_NAME }}
                </h2>
                <span class="department-id">ID: {{ dep.departament_ID }}</span>
            </div>

            <div class="department-managers" style="display: {% if dep.managers_list %}block{% else %}none{% endif %};">
                <div class="managers-label">üëî –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–∏:</div>
                <div class="managers-list">{{ dep.managers_list|join:", " }}</div>
            </div>

            <div class="employees-section">
                {% if dep.employees_list %}
                    <div class="employees-grid">
                        {% for emp in dep.employees_list %}
                            <div class="employee-card">
                                <div class="employee-avatar">
                                    {% if emp.avatar %}
                                        <img src="{{ emp.avatar }}" alt="–§–æ—Ç–æ {{ emp.name }}" class="avatar-image">
                                    {% else %}
                                        <div class="avatar-placeholder">
                                            <span class="avatar-icon">üë§</span>
                                        </div>
                                    {% endif %}
                                </div>

                                <div class="employee-info">
                                    <a href="javascript:void(0);" class="employee-name-link" data-user-id="{{ emp.id }}">
                                        <div class="employee-name">{{ emp.name }}</div>
                                    </a>
                                    <div class="employee-id">ID: {{ emp.id }}</div>
                                    <div class="employee-position">{{ emp.work_position|default:"‚Äî" }}</div>
                                </div>

                                <div class="employee-stats">
                                    <div class="calls-badge">
                                        <span class="calls-icon">üìû</span>
                                        <span class="calls-count">{{ emp.calls24|default:"0" }}</span>
                                        <span class="calls-label">–∑–∞ 24—á</span>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-department">
                        <div class="empty-icon">üö´</div>
                        <div class="empty-message">–í —ç—Ç–æ–º –æ—Ç–¥–µ–ª–µ –ø–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</div>
                    </div>
                {% endif %}
            </div>
        </div>
    {% empty %}
        <div class="no-departments">
            <div class="no-departments-icon">üè¢</div>
            <h3>–û—Ç–¥–µ–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
            <p>–ü–æ–∫–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ—Ç–¥–µ–ª–∞</p>
        </div>
    {% endfor %}
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Bitrix24 API -->
<script src="https://api.bitrix24.com/api/v1/"></script>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º Bitrix24 API
BX24.init(function() {
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–∞ –Ω–∞ –∏–º–µ–Ω–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
    const employeeLinks = document.querySelectorAll('.employee-name-link');

    employeeLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const userId = this.getAttribute('data-user-id');

            // –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ Bitrix24 API
            BX24.openPath("/company/personal/user/" + userId + "/");
        });
    });

    console.log('Bitrix24 API –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã');
});

// –§–æ–ª–±—ç–∫ –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ BX24 API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
setTimeout(function() {
    if (typeof BX24 === 'undefined' || !BX24.init) {
        console.warn('Bitrix24 API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥');

        const employeeLinks = document.querySelectorAll('.employee-name-link');
        employeeLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const userId = this.getAttribute('data-user-id');
                alert('–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ID: ' + userId + '\nBitrix24 API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            });
        });
    }
}, 2000);
</script>

<style>
/* –°—Ç–∏–ª–∏ –¥–ª—è —Å—Å—ã–ª–∫–∏ –∏–º–µ–Ω–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ */
.employee-name-link {
    text-decoration: none;
    color: inherit;
    display: block;
    cursor: pointer;
}

.employee-name-link:hover .employee-name {
    color: var(--secondary-color);
    text-decoration: underline;
}

.employee-name {
    transition: var(--transition, all 0.3s ease);
}

/* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
.departments-container {
    display: flex;
    flex-direction: column;
    gap: 2rem;
}

.department-card {
    background: var(--background-color, #ffffff);
    border-radius: var(--border-radius, 8px);
    box-shadow: var(--shadow, 0 2px 10px rgba(0, 0, 0, 0.1));
    overflow: hidden;
    border: 1px solid var(--border-color, #dee2e6);
}

.department-header {
    background: linear-gradient(135deg, var(--primary-color, #2c3e50), var(--secondary-color, #3498db));
    color: white;
    padding: 1.5rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.department-title {
    font-size: 1.3rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin: 0;
}

.department-icon {
    font-size: 1.2rem;
}

.department-id {
    font-size: 0.9rem;
    opacity: 0.8;
    background: rgba(255, 255, 255, 0.2);
    padding: 0.3rem 0.7rem;
    border-radius: 15px;
}

.department-managers {
    background: var(--background-light, #f8f9fa);
    padding: 1rem 2rem;
    border-bottom: 1px solid var(--border-color, #dee2e6);
}

.managers-label {
    font-weight: 600;
    color: var(--primary-color, #2c3e50);
    margin-bottom: 0.5rem;
}

.managers-list {
    color: var(--text-color, #2c3e50);
    font-weight: 500;
}

.employees-section {
    padding: 2rem;
}

.employees-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
}

.employee-card {
    background: var(--background-light, #f8f9fa);
    border: 1px solid var(--border-color, #dee2e6);
    border-radius: var(--border-radius, 8px);
    padding: 1.5rem;
    transition: var(--transition, all 0.3s ease);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.employee-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    background: var(--background-color, #ffffff);
}

.employee-avatar {
    margin-bottom: 1rem;
}

.avatar-image {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--secondary-color, #3498db);
    box-shadow: var(--shadow, 0 2px 10px rgba(0, 0, 0, 0.1));
}

.avatar-placeholder {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--border-color, #dee2e6);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid var(--text-light, #7f8c8d);
}

.avatar-icon {
    font-size: 2rem;
    color: var(--text-light, #7f8c8d);
}

.employee-info {
    margin-bottom: 1rem;
}

.employee-name {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-color, #2c3e50);
    margin-bottom: 0.3rem;
}

.employee-id {
    font-size: 0.8rem;
    color: var(--text-light, #7f8c8d);
    margin-bottom: 0.5rem;
}

.employee-position {
    font-size: 1rem;
    color: var(--text-color, #2c3e50);
    font-weight: 500;
}

.employee-stats {
    width: 100%;
}

.calls-badge {
    background: linear-gradient(135deg, var(--success-color, #27ae60), #2ecc71);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: var(--border-radius, 8px);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-weight: 600;
}

.calls-icon {
    font-size: 1rem;
}

.calls-count {
    font-size: 1.2rem;
    font-weight: 700;
}

.calls-label {
    font-size: 0.8rem;
    opacity: 0.9;
}

.empty-department {
    text-align: center;
    padding: 3rem 2rem;
    color: var(--text-light, #7f8c8d);
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.empty-message {
    font-size: 1.1rem;
    font-style: italic;
}

.no-departments {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-light, #7f8c8d);
}

.no-departments-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
}

.no-departments h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--primary-color, #2c3e50);
}

.no-departments p {
    font-size: 1.1rem;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
    .employees-grid {
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1rem;
    }
}

@media (max-width: 768px) {
    .department-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
        padding: 1rem 1.5rem;
    }

    .department-managers {
        padding: 1rem 1.5rem;
    }

    .employees-section {
        padding: 1.5rem;
    }

    .employees-grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }

    .employee-card {
        padding: 1rem;
    }

    .avatar-image,
    .avatar-placeholder {
        width: 60px;
        height: 60px;
    }

    .avatar-icon {
        font-size: 1.5rem;
    }
}

@media (max-width: 480px) {
    .departments-container {
        gap: 1.5rem;
    }

    .department-header {
        padding: 1rem;
    }

    .department-title {
        font-size: 1.1rem;
    }

    .department-managers {
        padding: 0.75rem 1rem;
    }

    .employees-section {
        padding: 1rem;
    }

    .employees-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
    }

    .employee-card {
        padding: 1rem 0.75rem;
    }

    .empty-department {
        padding: 2rem 1rem;
    }

    .empty-icon {
        font-size: 2.5rem;
    }

    .no-departments {
        padding: 3rem 1rem;
    }

    .no-departments-icon {
        font-size: 3rem;
    }
}

/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞–Ω–∏–º–∞—Ü–∏–∏ */
.employee-card .calls-badge {
    transition: var(--transition, all 0.3s ease);
}

.employee-card:hover .calls-badge {
    transform: scale(1.05);
}

.department-card {
    transition: var(--transition, all 0.3s ease);
}

.department-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
}
</style>

{% endblock %}